<html>
  <head>
    <title 測試></title>
<!--     <script src="https://d.line-scdn.net/liff/1.0/sdk.js"></script> -->
    <script>
      ! function(e) {
          var t = {};

          function n(r) {
              if (t[r]) return t[r].exports;
              var o = t[r] = {
                  i: r,
                  l: !1,
                  exports: {}
              };
              return e[r].call(o.exports, o, o.exports, n), o.l = !0, o.exports
          }
          n.m = e, n.c = t, n.d = function(e, t, r) {
              n.o(e, t) || Object.defineProperty(e, t, {
                  configurable: !1,
                  enumerable: !0,
                  get: r
              })
          }, n.r = function(e) {
              Object.defineProperty(e, "__esModule", {
                  value: !0
              })
          }, n.n = function(e) {
              var t = e && e.__esModule ? function() {
                  return e.default
              } : function() {
                  return e
              };
              return n.d(t, "a", t), t
          }, n.o = function(e, t) {
              return Object.prototype.hasOwnProperty.call(e, t)
          }, n.p = "", n(n.s = 99)
      }({
          11: function(e, t, n) {
              "use strict";
              Object.defineProperty(t, "__esModule", {
                  value: !0
              }), t.default = function(e, t) {
                  var n = new Error(t);
                  return n.code = e, n
              }
          },
          27: function(e, t) {
              e.exports = {
                  pull: function(e) {
                      try {
                          var t = JSON.parse(sessionStorage.getItem("liffinfo"));
                          e._auth = t._auth, e._features = t._features
                      } catch (e) {}
                  },
                  push: function(e) {
                      try {
                          sessionStorage.setItem("liffinfo", JSON.stringify({
                              _auth: e._auth,
                              _features: e._features
                          }))
                      } catch (e) {
                          console.log(e)
                      }
                  }
              }
          },
          29: function(e, t, n) {
              "use strict";
              Object.defineProperty(t, "__esModule", {
                  value: !0
              }), t.default = void 0;
              var r = {
                  liffVersionMapping: [
                      ["1.0.0", "0.0.0", "0.0.0"]
                  ],
                  JS_BASE: "https://d.line-scdn.net/n/liff"
              };
              t.default = r
          },
          30: function(e, t, n) {
              "use strict";
              Object.defineProperty(t, "__esModule", {
                  value: !0
              }), t.default = function(e, t, n) {
                  var r = document.createElement("script");
                  r.src = e, t && (r.onload = t), n && (r.onerror = n), document.getElementsByTagName("head")[0].appendChild(r)
              }
          },
          46: function(e, t, n) {
              "use strict";
              Object.defineProperty(t, "__esModule", {
                  value: !0
              }), t.default = function() {
                  var e = window.navigator.userAgent.toLowerCase();
                  if (/iphone|ipad|ipod/.test(e)) return "ios";
                  if (/android/.test(e)) return "android";
                  return "other"
              }
          },
          95: function(e, t) {
              function n(e) {
                  return (n = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                      return typeof e
                  } : function(e) {
                      return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                  })(e)
              }
              var r = ["userId", "type", "groupId", "roomId", "utouId", "squareId", "squareMemberId", "squareChatId", "viewType", "accessTokenHash"];
              t.parse = function(e) {
                  for (var t = e.substr(1).split("&"), n = {}, o = 0; o < t.length; o++) {
                      var i = t[o].split("=");
                      n[i[0]] = decodeURIComponent(i[1])
                  }
                  var a = null;
                  if (n.context_token) {
                      a = {};
                      for (var f = this.parseContextToken(n.context_token), u = 0; u < r.length; u++) {
                          var s = r[u];
                          a[s] = f[s]
                      }
                  }
                  var l = {
                      accessToken: n.access_token,
                      featureToken: n.feature_token,
                      context: a
                  };
                  pp(`accessToken ${n.access_token}`);
                  pp(`featureToken ${n.feature_token}`);
                  pp(`context ${Object.entries(a)}`);
                  return this.valid(l)
              }, t.parseContextToken = function(e) {
                  try {
                      var t = e.split(".")[1];
                      return JSON.parse(window.atob(t))
                  } catch (e) {
                      console.error("invalid context_token")
                  }
              }, t.valid = function(e) {
                  if ("string" != typeof e.accessToken) throw new Error;
                  if ("string" != typeof e.featureToken) throw new Error;
                  return "object" === ("undefined" == typeof context ? "undefined" : n(context)) && r.map(function(t) {
                      if ("string" != typeof e.context[t]) throw new Error
                  }), e
              }
          },
          96: function(e, t, n) {
              var r = n(95),
                  o = n(27),
                  i = {
                      _auth: null,
                      _features: []
                  };
              o.pull(i);
              try {
                  var a = r.parse(location.hash);
                  delete a.context.accessTokenHash, i._auth = a
              } catch (e) {}
              o.push(i);
              var f, u = [],
                  s = !1;
              if (window.addEventListener("liffEvent", function e(t) {
                      (s = i._runTasks(u)) && window.removeEventListener("liffEvent", e, !1)
                  }, !1), !window.CustomEvent) {
                  var l = function(e, t) {
                      var n;
                      return t = t || {
                          bubbles: !1,
                          cancelable: !1,
                          detail: void 0
                      }, (n = document.createEvent("CustomEvent")).initCustomEvent(e, t.bubbles, t.cancelable, t.detail), n
                  };
                  l.prototype = window.Event.prototype, window.CustomEvent = l
              }
              i.postMessage = function(e, t, n, r) {
                  var o = n || "";
                  try {
                      var a = JSON.stringify(r);
                      s ? window._liff.postMessage(e, t, o, a) : u.push([e, o, a])
                  } catch (e) {
                      i._dispatchErrorEvent(e)
                  }
              }, i._runTasks = function(e) {
                  if (window._liff && window._liff.postMessage) {
                      for (; e.length > 0;) {
                          var t = e.shift();
                          window._liff.postMessage(t[0], t[1], t[2])
                      }
                      return !0
                  }
                  return !1
              }, i._createNativeMessageEvent = function(e) {
                  return new CustomEvent("liffEvent", {
                      detail: e
                  })
              }, i._dispatchEvent = function(e) {
                  var t = {};
                  try {
                      if ("ready" === (t = JSON.parse(e)).type) {
                          if (t.language || (t.language = "[object Array]" === Object.prototype.toString.call(navigator.languages) ? navigator.languages[0] : navigator.language), f) return;
                          f = !0, t.auth = i._auth
                      }
                      var n = i._createNativeMessageEvent(t);
                      window.dispatchEvent(n)
                  } catch (e) {
                      i._dispatchErrorEvent(e)
                  }
              }, i._dispatchErrorEvent = function(e) {
                  var t = e + "",
                      n = i._createNativeMessageEvent({
                          type: "error",
                          callbackId: "",
                          data: {},
                          error: {
                              message: t
                          }
                      });
                  window.dispatchEvent(n)
              }, window.liff = i
          },
          97: function(e, t, n) {
              "use strict";
              Object.defineProperty(t, "__esModule", {
                  value: !0
              }), t.default = function(e) {
                  var t = (0, o.default)();
                  if ("other" === t) return e[e.length - 1][0];
                  var n = e.map(function(e) {
                          return e.map(i)
                      }),
                      r = n[0][0],
                      a = navigator.userAgent.toLowerCase().match(/line\/([\d|\.]+)/);
                  if (a)
                      for (var f = i(a[1]), u = "ios" === t ? 1 : 2, s = 0, l = n.length; s < l && (f[0] >= n[s][u][0] && f[1] >= n[s][u][1] && f[2] >= n[s][u][2]); s++) r = n[s][0];
                  else r = n[n.length - 1][0];
                  return r.join(".")
              }, t.parseVersionToArray = void 0;
              var r, o = (r = n(46)) && r.__esModule ? r : {
                  default: r
              };
              var i = function(e) {
                  for (var t = e.split(".").map(Number); t.length < 3;) t.push(0);
                  return t
              };
              t.parseVersionToArray = i
          },
          98: function(e, t, n) {
              "use strict";
              var r = u(n(30)),
                  o = u(n(46)),
                  i = u(n(97)),
                  a = u(n(29)),
                  f = u(n(11));

              function u(e) {
                  return e && e.__esModule ? e : {
                      default: e
                  }
              }
              n(96), liff._version = "1.0", liff._nativeVersion = (0, i.default)(a.default.liffVersionMapping);
              liff._revision = 1528437031149;
              var s = (0, o.default)(),
                  l = function(e, t, n) {
                      (0, r.default)("".concat(a.default.JS_BASE, "/").concat(liff._version, "/").concat(s, "/").concat(liff._nativeVersion, "/").concat(e, "_").concat(1528437031149, ".js"), t, n)
                  },
                  c = function() {
                      liff._error = (0, f.default)("INIT_FAILED", "Failed to init LIFF SDK"), liff._initErrorHandler && liff._initErrorHandler(liff._error)
                  };
              "function" == typeof window.Promise ? l("base", null, c) : (l("plugins/promise", null, c), liff._promiseInit = function() {
                  l("base", null, c), delete liff._promiseInit
              }), liff.init = function() {
                  "function" == typeof(arguments.length <= 0 ? void 0 : arguments[0]) && (liff._init = arguments.length <= 0 ? void 0 : arguments[0]), "function" == typeof(arguments.length <= 1 ? void 0 : arguments[1]) && (liff._initErrorHandler = arguments.length <= 1 ? void 0 : arguments[1]), liff._error && liff._initErrorHandler && liff._initErrorHandler(liff._error), liff._init && liff._initData && (liff._init(liff._initData), delete liff._init)
              }
          },
          99: function(e, t, n) {
              e.exports = n(98)
          }
      });
    </script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    
    <script>
      function pp(o) {
        let old = $("#msg").text();
        o = `${old}\n${o}`;
        $("#msg").text(o);
      }
      
      function sendMsg() {
        const urlParams = new URLSearchParams(window.location.search);
        const msg = urlParams.get('msg');
        window.alert(`urlParams = ${urlParams}`);
        liff.sendMessages([
          {
            type:'text',
            text:`Hello, ${msg}!`
          }
        ])
        .then(() => {
          pp('message sent');
          // liff.closeWindow();
        })
        .catch((err) => {
          pp(err);
        });
      }
      
      $(() => {
        window.liff = liff;
        liff.init(
          (data) => {
            pp(Object.entries(data.context));
            $("#send-btn").show();
          }, (err) => {
            pp(Object.entries(err));
          });
      });
    </script>
  </head>
  <body>
    <button id="send-btn" class="btn btn-link" style="display: none;" onclick="sendMsg()">
      取得動態密碼
    </button>
    <div id="msg">
      msg...
    </div>
  </body>
</html>
